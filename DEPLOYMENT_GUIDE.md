# IoT DO Sensor - Cloud Deployment Guide

This guide will help you deploy your DO Sensor IoT Dashboard to the cloud using **Render** (backend) and **Vercel** (frontend) on free tier.

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Raspberry Pi (DO Sensor Data Source)                   â”‚
â”‚  Sends data to: https://[RENDER-BACKEND-URL]/api/...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                                      â”‚
               â–¼                                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  RENDER BACKEND      â”‚        â”‚  VERCEL FRONTEND     â”‚
    â”‚  (Node.js + Express) â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚  (Vite + React)      â”‚
    â”‚  Port: 5000          â”‚        â”‚  Hosted on Vercel    â”‚
    â”‚  â”œâ”€ PostgreSQL DB    â”‚        â”‚                      â”‚
    â”‚  â”œâ”€ Auth Service     â”‚        â”‚  Dashboard UI        â”‚
    â”‚  â”œâ”€ Sensor APIs      â”‚        â”‚  Real-time Charts    â”‚
    â”‚  â””â”€ Data Export      â”‚        â”‚  User Management     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Prerequisites

1. **GitHub Account**: Repository already created
2. **Render Account**: https://render.com (free tier)
3. **Vercel Account**: https://vercel.com (free tier)
4. **PostgreSQL**: Will be provided by Render (free tier)

---

## Step 1: Deploy Backend to Render

### 1.1 Connect Your GitHub Repository to Render

1. Go to [https://render.com](https://render.com)
2. Sign up or log in with your GitHub account
3. Click **New +** â†’ **Web Service**
4. Select **Deploy from GitHub**
5. Search for and select: `IoT-based-DO-Sensor-Monitoring`
6. Click **Connect**

### 1.2 Configure Backend Deployment

**Name**: `do-sensor-backend`

**Environment**: Leave as Node

**Branch**: `main`

**Build Command**: `npm install`

**Start Command**: `npm start`

**Advanced Settings**:
- **Instance Type**: Free
- **Region**: Oregon (or closest to you)

### 1.3 Set Environment Variables

Before deploying, click **Environment** and add these variables:

```
NODE_ENV = production
JWT_SECRET = (will be auto-generated by Render)
JWT_EXPIRY = 24h
CORS_ORIGIN = https://[YOUR-VERCEL-DOMAIN].vercel.app
BACKEND_PORT = 5000
DEVICE_ID = sensor-001
DEVICE_API_KEY = your-device-api-key
```

### 1.4 Create PostgreSQL Database

1. In Render Dashboard, click **New +** â†’ **PostgreSQL**
2. **Name**: `do-sensor-db`
3. **PostgreSQL Version**: Latest
4. **Region**: Oregon
5. **Datastore Name**: `do_sensor_db`
6. **Plan**: Free
7. Click **Create Database**

### 1.5 Connect Database to Backend

1. Go back to your web service (`do-sensor-backend`)
2. Click **Environment**
3. Add the environment variable:
   - **Key**: `DATABASE_URL`
   - **Value**: Copy the connection string from your PostgreSQL database (shown under "Connections")
4. Click **Deploy**

**Wait for deployment** (5-10 minutes). You'll get a URL like:
```
https://do-sensor-backend.onrender.com
```

### 1.6 Test Backend Health

Open in browser:
```
https://do-sensor-backend.onrender.com/api/health
```

You should see:
```json
{"ok": true, "time": 1733700000000}
```

---

## Step 2: Deploy Frontend to Vercel

### 2.1 Connect GitHub to Vercel

1. Go to [https://vercel.com](https://vercel.com)
2. Sign up or log in with GitHub
3. Click **Add New** â†’ **Project**
4. Import your GitHub repository: `IoT-based-DO-Sensor-Monitoring`
5. Click **Import**

### 2.2 Configure Frontend

**Project Name**: `do-sensor-dashboard`

**Framework**: Vite

**Root Directory**: `./frontend`

### 2.3 Set Environment Variables

Before deploying, add this environment variable:

```
VITE_API_BASE = https://do-sensor-backend.onrender.com/api
```

Replace `do-sensor-backend` with your actual Render backend name.

### 2.4 Deploy

Click **Deploy** and wait for completion (2-3 minutes).

You'll get a URL like:
```
https://do-sensor-dashboard.vercel.app
```

### 2.5 Update Backend CORS

1. Go back to Render Backend settings
2. Update `CORS_ORIGIN` environment variable to:
   ```
   https://do-sensor-dashboard.vercel.app
   ```
3. Save and redeploy backend

---

## Step 3: Configure Your Raspberry Pi

Update your Pi's sensor data endpoint to send data to your backend:

### Backend Endpoints Available:

**Register New User**:
```bash
curl -X POST https://do-sensor-backend.onrender.com/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "your-email@example.com",
    "password": "secure-password"
  }'
```

**Submit Sensor Reading**:
```bash
curl -X POST https://do-sensor-backend.onrender.com/api/readings \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "sensor_id": "sensor-001",
    "do_level": 8.5,
    "temperature": 25.3,
    "pressure": 1013.25
  }'
```

---

## Step 4: Verify Full Deployment

### 4.1 Test Frontend Access
```
https://do-sensor-dashboard.vercel.app
```

You should see:
- Login/Register page
- No CORS errors in browser console
- Ability to create an account

### 4.2 Test Backend API
```bash
curl https://do-sensor-backend.onrender.com/api/health
```

### 4.3 Check Database Connection
Once logged in, try accessing the dashboard. Data should load without errors.

---

## Important Notes

### Free Tier Limits:

**Render**:
- Auto-spins down after 15 minutes of inactivity
- First request after spin-down takes 30-60 seconds
- PostgreSQL free tier has limited storage
- No automatic backups

**Vercel**:
- Deployments limited to 10GB
- 12 deployments per day
- 100MB function size limit

### Production Readiness Checklist:

- [ ] Backend deployed and health check passing
- [ ] PostgreSQL database connected and initialized
- [ ] Frontend deployed and accessible
- [ ] CORS configured correctly
- [ ] Environment variables set in both services
- [ ] JWT_SECRET generated (Render auto-generates)
- [ ] Device API key configured for Pi
- [ ] Sensor data successfully posting to backend
- [ ] Dashboard displaying real-time data
- [ ] User authentication working
- [ ] Data export features functional

---

## Troubleshooting

### Backend Not Responding

1. Check if service is running in Render dashboard
2. Check logs: Click your service â†’ Logs
3. Verify DATABASE_URL is set correctly
4. Restart the service

### Frontend Can't Connect to Backend

1. Check VITE_API_BASE in Vercel environment variables
2. Check CORS_ORIGIN in Render backend
3. Clear browser cache and cookies
4. Check browser console for specific errors

### Database Connection Error

1. Verify DATABASE_URL is correct format
2. Check PostgreSQL database is running
3. Ensure database credentials are correct
4. Try restarting both services

### Slow First Load

This is normal on free tier! The service spins down after inactivity.
- First request: 30-60 seconds
- Subsequent requests: normal speed
- Upgrade to paid tier for instant availability

---

## Next Steps

1. **Monitor Dashboard**: Watch your sensor data in real-time
2. **Configure Auto-Start on Pi**: Set up cron job for continuous data submission
3. **Set Alerts**: Implement email/notification alerts for critical DO levels
4. **Backup Data**: Regularly export sensor readings
5. **Upgrade**: If free tier becomes limiting, upgrade both services to paid

---

## Support & Resources

- **Render Docs**: https://render.com/docs
- **Vercel Docs**: https://vercel.com/docs
- **PostgreSQL Docs**: https://www.postgresql.org/docs/
- **Project GitHub**: https://github.com/Agnibha2003/IoT-based-DO-Sensor-Monitoring

---

**Deployment Complete! Your IoT Dashboard is now live and accessible remotely.** ğŸ‰
